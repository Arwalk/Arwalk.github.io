node{
    echo 'Pulling...' + env.BRANCH_NAME
    
    if(env.BRANCH_NAME == 'master'){
        
        stage('building and publishing release branch'){
            
            checkout poll: false, scm: [$class: 'GitSCM', branches: [[name: '$BRANCH_NAME']], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'SubmoduleOption', disableSubmodules: false, parentCredentials: false, recursiveSubmodules: true, reference: '', trackingSubmodules: false]], submoduleCfg: [], userRemoteConfigs: [[credentialsId: 'Gitea_arwalk', url: 'http://git.arwalk.net/Arwalk/BlogSources']]]
            sh label: 'build and publish to gh-pages branch', script: '''#!/bin/bash
                ghp-import -m "Generate Pelican site" -b gh-pages output
                git push http://git.arwalk.net/Arwalk/BlogSources gh-pages:gh-pages'''  
            
        }
    } else if (env.BRANCH_NAME == 'gh-pages') {
        stage('publishing to github') {
            checkout poll: false, scm: [$class: 'GitSCM', branches: [[name: '$BRANCH_NAME']], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'SubmoduleOption', disableSubmodules: false, parentCredentials: false, recursiveSubmodules: true, reference: '', trackingSubmodules: false]], submoduleCfg: [], userRemoteConfigs: [[credentialsId: 'Gitea_arwalk', url: 'http://git.arwalk.net/Arwalk/BlogSources']]]

            sh label: 'publish gh-pages to master branch', script: '''#!/bin/bash
                git push https://github.com/Arwalk/Arwalk.github.io gh-pages:master'''
        }
    } else {
        stage('building development branch'){
            checkout poll: false, scm: [$class: 'GitSCM', branches: [[name: '$BRANCH_NAME']], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'SubmoduleOption', disableSubmodules: false, parentCredentials: false, recursiveSubmodules: true, reference: '', trackingSubmodules: false]], submoduleCfg: [], userRemoteConfigs: [[credentialsId: 'Gitea_arwalk', url: 'http://git.arwalk.net/Arwalk/BlogSources']]]

            sh label: 'build html', script: '''#!/bin/bash
                                                make html'''
        }
    }
    
}